# Aspire Postgres Migration Issue

### Note Only For Me
Please refrain from deleting this repo because it is being used for a "bug" report.

### Description
The log below shows that the migration fails at first but succeeds later.
I am wondering what causes this.
```
Waiting for resource 'pgServer' to enter the 'Running' state.
Waiting for resource 'pgDb' to enter the 'Running' state.
Waiting for resource 'pgServer' to become healthy.
Waiting for resource 'pgDb' to become healthy.
Waiting for resource ready to execute for 'pgServer'.
Finished waiting for resource 'pgServer'.
Waiting for resource ready to execute for 'pgDb'.
Finished waiting for resource 'pgDb'.
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: C:\Users\XYZ\source\repos\AspirePostgresMigrationIssue\AspirePostgresMigrationIssue.MigrationService
fail: Microsoft.EntityFrameworkCore.Database.Command[20102]
      Failed executing DbCommand (1,087ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT "MigrationId", "ProductVersion"
      FROM "__EFMigrationsHistory"
      ORDER BY "MigrationId";
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (21ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
          "MigrationId" character varying(150) NOT NULL,
          "ProductVersion" character varying(32) NOT NULL,
          CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
      );
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (6ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      LOCK TABLE "__EFMigrationsHistory" IN ACCESS EXCLUSIVE MODE
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (11ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT "MigrationId", "ProductVersion"
      FROM "__EFMigrationsHistory"
      ORDER BY "MigrationId";
info: Microsoft.EntityFrameworkCore.Migrations[20402]
      Applying migration '20250615081850_Initialization'.
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (6ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      CREATE TABLE "Students" (
          "Id" integer GENERATED BY DEFAULT AS IDENTITY,
          "FullName" text NOT NULL,
          CONSTRAINT "PK_Students" PRIMARY KEY ("Id")
      );
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (5ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
      VALUES ('20250615081850_Initialization', '9.0.6');
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (47ms) [Parameters=[@p0='?', @p1='?', @p2='?'], CommandType='Text', CommandTimeout='30']
      INSERT INTO "Students" ("FullName")
      VALUES (@p0)
      RETURNING "Id";
      INSERT INTO "Students" ("FullName")
      VALUES (@p1)
      RETURNING "Id";
      INSERT INTO "Students" ("FullName")
      VALUES (@p2)
      RETURNING "Id";
info: AspirePostgresMigrationIssue.MigrationService.Worker[0]
      Database migration completed successfully.
info: Microsoft.Hosting.Lifetime[0]
      Application is shutting down...
```
